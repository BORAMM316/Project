<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">

    <style>
        body {display:flex; justify-content:space-around; flex-wrap:wrap; background:url('resources/images/bg_gradation.png') 50% 50% no-repeat; background-size:cover;}
        .box {position:relative; width:700px;}
        .box canvas {position:absolute; top:0; left:0; width:100%; height:100%; color:#ddd;}
        video {outline:none;}
    </style>

    <title>Chromakey Test || AI Human</title>
</head>
<body>
    <video class="video" src="resources/video/test01.mp4" autoplay loop muted width="700"></video>
    <div class="box">
        <canvas class="canvas" width="700"></canvas>
    </div>

    <script>
        const video = document.querySelector('.video');
        let width = video.clientWidth;
        let height = video.clientHeight;

        const canvas = document.querySelector('.canvas');
        canvas.setAttribute('height', height);
        const ctx = canvas.getContext('2d');
        window.addEventListener('load', drawVideo);

        function drawVideo(){
            ctx.drawImage(video, 0, 0, width, height);

            let frame = ctx.getImageData(0, 0, width, height);
            for(let i = 0; i < frame.data.length; i++){
                let r = frame.data[i];      // red
                let g = frame.data[i + 1];  // green
                let b = frame.data[i + 2];  // blue

                // test01 / rgb(7, 254, 0)
                if( r > 1 && r < 120 && g > 90 && g < 255 && b < 170 ){
                    frame.data[i + 3] = 0
                }

                // test02
                // if( r > 50 && r < 90 && g > 75 && g < 150 && b < 80 ){
                //     frame.data[i + 3] = 0;
                // }

                // test03
                // if( r > 60 && r < 140 && g > 120 && g < 170 && b < 90 ){
                //     frame.data[i + 3] = 0;
                // }

                // test04
                // if( r > 60 && r < 140 && g > 120 && g < 170 && b < 90 ){
                //     frame.data[i + 3] = 0;
                // }

                // test05 / rgb(7, 254, 0)
                // if( r > 10 && r < 80 && g > 100 && g < 180 && b < 100 ){
                //     frame.data[i + 3] = 0
                // }
            }

            ctx.putImageData(frame,0,0);

            requestAnimationFrame(drawVideo);
        }
    </script>
</body>
</html>